# HDD Hardware replacaement

### Hardware Replacement

Start by recording the new HDD serial number somewhere, as this will identify the new HDD

![](<../.gitbook/assets/image (66).png>)

After removing the failed disk, make a note of the Serial Number for use below

### Updating Config

After physically replacing the hardware, the software requires configuration to setup and use. Start by listing all the disks in the system using the utility

```
devblk_info.lua
```

Below is an example output

![](<../.gitbook/assets/image (5) (2).png>)

Note in the above, the HDD with serial number 59BAK1ILFAYG has no mapping. This could be either hdd\* or par\* it depends on which disk is being replaced.

Confirm the new disks matches this unmapped serial number per the step above (make note of the new disks serial number)

Next edit the disk config the file is located in

```
/opt/fmadio/etc/disk.lua
```

From the steps above (record the Serial Number of the failed disk) search for the failed disks serial number in the example config file below.

```
fmadio@fmadio20v3-287:~$ cat /mnt/store0/etc/disk.lua
```

```lua
-- autogenerated by www_fcgibackend Sun Mar 13 09:08:47 2022
return {
["RaidDisk"] =
{
    ["59B7K1TBFAYG"]    = "hdd1",
    ["59BWK0TSFAYG"]    = "hdd0",
    ["59BB91ILFAYG"]    = "hdd2",
},
["CacheDisk"] =
{
    ["S463NF0M326113F"]    = "ssd0",
    ["S463NF0M326150N"]    = "ssd1",
},
{
    ["59B7K1TCFAYG"]    = "par0",
},
["OSDisk"] =
{
    ["B0710214200000003B7B"]    = "os0",
},
.
.
.
<snip>

```

Notice the serial number for hdd2 is 59BB91ILFAYG which is our failed HDD, as hdd2 is missing in the devblk\_info.lua output. In addition confirm the serial number matches the removed physical hardware.

Change the failed serial number to the new serial number. In this case we are changing 59BB91ILFAYG (old) -> 59BAK1ILFAYG (new).

The following is a snipped of the new configuration

```lua
["RaidDisk"] =
{
    ["59B7K1TBFAYG"]    = "hdd1",
    ["59BWK0TSFAYG"]    = "hdd0",
    ["59BAK1ILFAYG"]    = "hdd2",
},
```

Save the file&#x20;

Run devblk\_info.lua again to confirm the mapping is good

![](<../.gitbook/assets/image (11).png>)

Notice how 59BAK1ILFAYG now has a mapping to hdd2.

If the disk still has a blank mapping, please double check the serial number was entered exactly (same capitalization, no spaces)

### Array Formatting

In many cases formatting the array is preferable to a long and slow rebuild as the systems down time is significantly less.

Array formatting is selecting the quick format option on the TOOLS tab as follows

![](../.gitbook/assets/image.png)

This will format the index and reset the array. It will reboot the system 2 times and take 5 to 30min depending on the total size of the storage.

After format is complete the system is ready for use.
